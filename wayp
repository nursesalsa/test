local HttpService = game:GetService("HttpService")
local placeId = tostring(game.PlaceId)
local filename = "waypoints_" .. placeId .. ".json"

local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local SetWaypointButton = Instance.new("TextButton")
local ViewHistoryButton = Instance.new("TextButton")
local HistoryFrame = Instance.new("Frame")
local NamePromptFrame = Instance.new("Frame")
local NameTextBox = Instance.new("TextBox")
local DoneButton = Instance.new("TextButton")
local waypoints = {}

-- Fungsi utility untuk gaya Easter Egg
local function styleButton(button, color)
	button.BackgroundColor3 = color
	button.TextColor3 = Color3.fromRGB(80, 40, 80)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 12)
	corner.Parent = button
end

local function styleFrame(frame, color)
	frame.BackgroundColor3 = color
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 12)
	corner.Parent = frame
end

-- Fungsi simpan dan muat
local function saveWaypoints()
	local json = HttpService:JSONEncode(waypoints)
	writefile(filename, json)
end

local function loadWaypoints()
	if isfile(filename) then
		local data = readfile(filename)
		local decoded = HttpService:JSONDecode(data)
		if typeof(decoded) == "table" then
			waypoints = decoded
		end
	end
end

-- GUI Setup
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

styleFrame(Frame, Color3.fromRGB(255, 230, 240)) -- Pink pastel
Frame.Parent = ScreenGui
Frame.Position = UDim2.new(0.5, -75, 0.5, -50)
Frame.Size = UDim2.new(0, 150, 0, 100)
Frame.Active = true
Frame.Draggable = true

styleButton(SetWaypointButton, Color3.fromRGB(255, 240, 170)) -- Kuning pastel
SetWaypointButton.Parent = Frame
SetWaypointButton.Position = UDim2.new(0.25, 0, 0.1, 0)
SetWaypointButton.Size = UDim2.new(0.5, 0, 0.35, 0)
SetWaypointButton.Text = "ðŸŒ¸ Set Waypoint"

SetWaypointButton.MouseButton1Click:Connect(function()
	NamePromptFrame.Visible = true
end)

styleButton(ViewHistoryButton, Color3.fromRGB(200, 255, 230)) -- Hijau mint
ViewHistoryButton.Parent = Frame
ViewHistoryButton.Position = UDim2.new(0.25, 0, 0.55, 0)
ViewHistoryButton.Size = UDim2.new(0.5, 0, 0.35, 0)
ViewHistoryButton.Text = "ðŸ“œ Waypoint List"

ViewHistoryButton.MouseButton1Click:Connect(function()
	HistoryFrame.Visible = not HistoryFrame.Visible
end)

styleFrame(HistoryFrame, Color3.fromRGB(245, 245, 255)) -- Biru pastel
HistoryFrame.Parent = Frame
HistoryFrame.Position = UDim2.new(-1.05, 0, 0, 0)
HistoryFrame.Size = UDim2.new(1, 0, 1, 0)
HistoryFrame.Visible = false

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 4)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = HistoryFrame

local UIPadding = Instance.new("UIPadding")
UIPadding.PaddingTop = UDim.new(0, 5)
UIPadding.PaddingBottom = UDim.new(0, 5)
UIPadding.PaddingLeft = UDim.new(0, 5)
UIPadding.PaddingRight = UDim.new(0, 5)
UIPadding.Parent = HistoryFrame

styleFrame(NamePromptFrame, Color3.fromRGB(255, 245, 245))
NamePromptFrame.Parent = ScreenGui
NamePromptFrame.Position = UDim2.new(0.5, -100, 0.5, -50)
NamePromptFrame.Size = UDim2.new(0, 200, 0, 100)
NamePromptFrame.Visible = false

NameTextBox.Parent = NamePromptFrame
NameTextBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
NameTextBox.Position = UDim2.new(0.1, 0, 0.2, 0)
NameTextBox.Size = UDim2.new(0.8, 0, 0.4, 0)
NameTextBox.Text = "Enter waypoint name"
NameTextBox.TextColor3 = Color3.fromRGB(100, 0, 100)
local ntbCorner = Instance.new("UICorner")
ntbCorner.CornerRadius = UDim.new(0, 8)
ntbCorner.Parent = NameTextBox

styleButton(DoneButton, Color3.fromRGB(200, 220, 255))
DoneButton.Parent = NamePromptFrame
DoneButton.Position = UDim2.new(0.3, 0, 0.7, 0)
DoneButton.Size = UDim2.new(0.4, 0, 0.2, 0)
DoneButton.Text = "âœ… Done"

-- Fungsi untuk menambahkan 1 waypoint ke UI
local function addWaypointToUI(waypoint)
	local entryFrame = Instance.new("Frame")
	entryFrame.Size = UDim2.new(1, 0, 0, 24)
	entryFrame.BackgroundTransparency = 1
	entryFrame.Parent = HistoryFrame

	local deleteButton = Instance.new("TextButton")
	deleteButton.Size = UDim2.new(0, 20, 1, 0)
	deleteButton.Position = UDim2.new(0, 0, 0, 0)
	deleteButton.Text = "âœ–"
	deleteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	deleteButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
	deleteButton.Parent = entryFrame
	local delCorner = Instance.new("UICorner")
	delCorner.CornerRadius = UDim.new(0, 6)
	delCorner.Parent = deleteButton

	local label = Instance.new("TextButton")
	label.Size = UDim2.new(1, -25, 1, 0)
	label.Position = UDim2.new(0, 25, 0, 0)
	label.Text = waypoint.name
	label.TextColor3 = Color3.fromRGB(60, 0, 60)
	label.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = entryFrame
	local labelCorner = Instance.new("UICorner")
	labelCorner.CornerRadius = UDim.new(0, 6)
	labelCorner.Parent = label

	label.MouseButton1Click:Connect(function()
		game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(waypoint.position)
		print("Teleported to waypoint: " .. waypoint.name)
	end)

	deleteButton.MouseButton1Click:Connect(function()
		entryFrame:Destroy()
		for i, wp in ipairs(waypoints) do
			if wp == waypoint then
				table.remove(waypoints, i)
				print("Deleted waypoint: " .. wp.name)
				saveWaypoints()
				break
			end
		end
	end)
end

-- Simpan waypoint saat selesai input
DoneButton.MouseButton1Click:Connect(function()
	local waypoint = {
		position = game.Players.LocalPlayer.Character.HumanoidRootPart.Position,
		name = NameTextBox.Text
	}
	table.insert(waypoints, waypoint)
	addWaypointToUI(waypoint)
	saveWaypoints()

	NamePromptFrame.Visible = false
	NameTextBox.Text = "Enter waypoint name"
end)

-- Load dari file dan tampilkan semua
loadWaypoints()
for _, wp in ipairs(waypoints) do
	addWaypointToUI(wp)
end
